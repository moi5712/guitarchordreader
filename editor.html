<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>吉他譜編輯器</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- 模態視窗 -->
    <div id="customModal" class="modal-overlay hidden">
      <div class="modal-content">
        <h3 id="modalTitle" class="modal-title"></h3>
        <p id="modalMessage" class="modal-message"></p>
        <div class="modal-actions">
          <button id="modalConfirmBtn" class="btn primary hidden">確定</button>
          <button id="modalCancelBtn" class="btn danger hidden">取消</button>
          <button id="modalAlertOkBtn" class="btn primary hidden">了解</button>
        </div>
      </div>
    </div>

    <!-- URL導入模態視窗 -->
    <div id="importUrlModal" class="modal-overlay hidden">
      <div class="modal-content">
        <h3 class="modal-title">從網址導入</h3>
        <p class="modal-message">
          請在下方貼上網址，每個網址一行。僅支援 ufret.jp 網站。
        </p>
        <textarea
          id="urlTextarea"
          class="editor-textarea"
          rows="10"
          placeholder="https://www.ufret.jp/song.php?data=..."
        ></textarea>
        <div class="modal-actions">
          <button id="importUrlConfirmBtn" class="btn primary">導入</button>
          <button id="importUrlCancelBtn" class="btn secondary">取消</button>
        </div>
      </div>
    </div>

    <!-- 頂部工具欄 -->
    <header class="topbar">
      <button id="homeBtn" class="btn primary">首頁</button>
      <button id="playBtn" class="btn secondary">演奏模式</button>

      <div class="sp"></div>

      <!-- 編輯工具 -->
      <button id="newBtn" class="btn-icon" title="新建">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 4.5v15m7.5-7.5h-15"
          />
        </svg>
      </button>
      <button id="importUrlBtn" class="btn-icon" title="從網址導入">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"
          />
        </svg>
      </button>
      <button id="importBtn" class="btn-icon" title="載入">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"
          />
        </svg>
      </button>
      <input
        id="importFile"
        type="file"
        accept=".txt,.gtab"
        style="display: none"
      />
      <button id="exportBtn" class="btn-icon" title="匯出">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"
          />
        </svg>
      </button>
      <button id="saveBtn" class="btn-icon" title="儲存">
        <svg
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          width="48px"
          height="48px"
          viewBox="0 0 24 24"
          aria-labelledby="saveIconTitle"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          fill="none"
          color="currentColor"
        >
          <path
            d="M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"
          />
          <rect width="10" height="8" x="7" y="13" />
          <rect width="8" height="5" x="8" y="3" />
        </svg>
      </button>
      <div class="divider"></div>
      <button id="undoBtn" class="btn-icon" title="復原 (Ctrl+Z)">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M7.49 12 3.74 8.248m0 0 3.75-3.75m-3.75 3.75h16.5V19.5"
          />
        </svg>
      </button>
      <button id="redoBtn" class="btn-icon" title="重做 (Ctrl+Y)">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m16.49 12 3.75-3.751m0 0-3.75-3.75m3.75 3.75H3.74V19.5"
          />
        </svg>
      </button>
      <button id="clearBtn" class="btn-icon danger" title="清空內容">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
          />
        </svg>
      </button>
    </header>

    <main class="wrap">
      <div class="editor-layout">
        <!-- 左側工具欄 -->
        <div class="left-sidebar">
          <!-- 歌曲資訊 -->
          <div class="panel">
            <div class="panel-header">歌曲資訊</div>
            <div class="panel-content">
              <div class="form-group">
                <label class="form-label">歌曲名稱</label>
                <input
                  id="songTitle"
                  class="input"
                  type="text"
                  placeholder="輸入歌曲名稱"
                />
              </div>
              <div class="form-group">
                <label class="form-label">演唱者</label>
                <input
                  id="songArtist"
                  class="input"
                  type="text"
                  placeholder="輸入演唱者"
                />
              </div>
              <div class="form-group">
                <label class="form-label">標籤</label>
                <input
                  id="songTags"
                  class="input"
                  type="text"
                  placeholder="以逗號分隔"
                />
              </div>
              <div class="form-group">
                <label class="form-label">調性</label>
                <select id="songKey" class="select">
                  <option value="">選擇調性</option>
                  <option value="C">C</option>
                  <option value="C#">C#</option>
                  <option value="Db">Db</option>
                  <option value="D">D</option>
                  <option value="D#">D#</option>
                  <option value="Eb">Eb</option>
                  <option value="E">E</option>
                  <option value="F">F</option>
                  <option value="F#">F#</option>
                  <option value="Gb">Gb</option>
                  <option value="G">G</option>
                  <option value="G#">G#</option>
                  <option value="Ab">Ab</option>
                  <option value="A">A</option>
                  <option value="A#">A#</option>
                  <option value="Bb">Bb</option>
                  <option value="B">B</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">BPM</label>
                <input
                  id="songBpm"
                  class="input"
                  type="number"
                  placeholder="120"
                  min="60"
                  max="200"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Capo</label>
                <input
                  id="songCapo"
                  class="input"
                  type="number"
                  placeholder="0"
                  min="-2"
                  max="12"
                />
              </div>
              <button
                id="updateMetaBtn"
                class="btn primary"
                style="width: 100%"
              >
                更新資訊
              </button>
            </div>
          </div>
        </div>

        <!-- 主編輯區域 -->

        <section class="card">
          <header class="meta">
            <p class="subtitle">吉他譜編輯器</p>
          </header>

          <div id="editorView" class="editor">
            <textarea
              id="editorTextarea"
              class="editor-textarea"
              placeholder="- 使用 [和弦名] 來標記和弦位置
- 使用 [intro], [verse], [chorus], [bridge] 等來標記段落
- 支援自訂義和弦指法：@C: 0,3,2,0,1,0"
            ></textarea>
          </div>
        </section>

        <!-- 右側工具 -->
        <div class="right-sidebar">
          <!-- 段落工具 -->
          <div class="panel">
            <div class="panel-header">段落工具</div>
            <div class="panel-content">
              <div class="section-grid" id="sectionGrid"></div>
            </div>
          </div>

          <!-- 常用和弦 -->
          <div class="panel">
            <div class="panel-header">常用和弦</div>
            <div class="panel-content">
              <div class="chord-grid" id="chordGrid"></div>
            </div>
          </div>

          <!-- 自訂和弦 -->
          <div class="panel">
            <div class="panel-header">自訂和弦</div>
            <div class="panel-content">
              <div class="form-group">
                <label class="form-label">和弦名稱</label>
                <input
                  id="customChordName"
                  class="input"
                  type="text"
                  placeholder="Cmaj7"
                  style="width: 100%"
                />
              </div>
              <div class="form-group">
                <label class="form-label">指法</label>
                <div
                  style="
                    display: grid;
                    grid-template-columns: repeat(6, 1fr);
                    gap: 4px;
                    margin-bottom: 8px;
                  "
                >
                  <input
                    id="fret6"
                    class="input"
                    type="text"
                    placeholder="6"
                    style="width: 100%; text-align: center; font-size: 12px"
                  />
                  <input
                    id="fret5"
                    class="input"
                    type="text"
                    style="width: 100%; text-align: center; font-size: 12px"
                  />
                  <input
                    id="fret4"
                    class="input"
                    type="text"
                    style="width: 100%; text-align: center; font-size: 12px"
                  />
                  <input
                    id="fret3"
                    class="input"
                    type="text"
                    style="width: 100%; text-align: center; font-size: 12px"
                  />
                  <input
                    id="fret2"
                    class="input"
                    type="text"
                    style="width: 100%; text-align: center; font-size: 12px"
                  />
                  <input
                    id="fret1"
                    class="input"
                    type="text"
                    placeholder="1"
                    style="width: 100%; text-align: center; font-size: 12px"
                  />
                </div>
                <div
                  style="
                    font-size: 12px;
                    color: var(--muted);
                    margin-bottom: 12px;
                  "
                >
                  1-12=品格位置 -1=不彈 0=空弦
                </div>
              </div>
              <button
                id="addCustomChordBtn"
                class="btn primary"
                style="width: 100%; margin-bottom: 12px"
              >
                新增自訂和弦
              </button>
              <div class="form-group">
                <div class="chord-grid" id="customChordGrid"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- <script src="functions.js"></script>
    <script src="editor.js"></script> -->
    <script type="module">
      import { initEditor } from "./modules/editor/ui.js";
      initEditor();
    </script>
  </body>
</html>
